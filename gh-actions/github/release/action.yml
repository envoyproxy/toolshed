inputs:
  artifacts:
    type: boolean
    default: true
  commit-message:
    type: string
    default:
  dry-run:
    type: boolean
    default: true
  event:
    type: string
    default:
  fail-if-exists:
    type: boolean
    default: true
  filter-artifacts:
    default: .
    type: string
  name:
    type: string
    required: true
  repository:
    type: string
    required: true
  sha:
    type: string
    required: true
  summary:
    type: boolean
    default: true
  template-release:
    type: string
    default: |
      export ASSETS=\"\($assets)\"
      export DEBUG=1
      export SHA=\"\(.sha)\"
      export TAG=\"\($tag)\"
      export TITLE=\"\($title)\"
      export REPO=\"\(.repo)\"
      export FAIL_IF_EXISTS=\"\(.fail_if_exists)\"
      export DRY_RUN=\"\(.dry_run)\"
      export NEXT_VERSION=\"\($next_version)\"
      export VERSION=\"\($version)\"
      export VERSION_FILE=\"\(.version_file)\"
      export REOPEN_MESSAGE=\"\($reopen_message)\"
      OUTPUT=$(${RELEASE_ACTION_PATH}/release.sh)
  token:
    type: string
    required: true
  version:
    type: string
    required: true
  version-file:
    type: string
    required: true
  workflows:
    type: string
    required: true

outputs:
  result:
    value: ${{ steps.release.outputs.output }}


runs:
  using: composite
  steps:
  - name: Check release status
    id: status
    uses: envoyproxy/toolshed/gh-actions/github/release/status@60f2bfe43da275d7e10b8d00987e14b5429b8590
    with:
      commit-message: ${{ inputs.commit-message }}
      event: ${{ inputs.event }}
      name: ${{ inputs.name }}
      repository: ${{ inputs.repository }}
      sha: ${{ inputs.sha }}
      version: ${{ inputs.version }}
      version-file: ${{ inputs.version-file }}
      workflows: ${{ inputs.workflows }}
  - id: artifacts
    if: >-
      inputs.artifacts
      && fromJSON(steps.status.outputs.continue)
    name: Download artifacts from workflow runs
    uses: envoyproxy/toolshed/gh-actions/github/release/artifacts@60f2bfe43da275d7e10b8d00987e14b5429b8590
    with:
      artifacts: ${{ inputs.artifacts }}
      filter-artifacts: ${{ inputs.filter-artifacts }}
      run-ids: ${{ steps.status.outputs.run-ids }}
      workflows: ${{ inputs.workflows }}
  - name: Publish the release
    if: >-
      fromJSON(steps.status.outputs.continue)
    uses: envoyproxy/toolshed/gh-actions/github/release/publish@60f2bfe43da275d7e10b8d00987e14b5429b8590
    with:
      artifacts: ${{ inputs.artifacts }}
      assets: ${{ inputs.artifacts && 'artifacts/publish/*' || '' }}
      dry-run: ${{ inputs.dry-run }}
      event: ${{ inputs.event }}
      fail-if-exists: ${{ inputs.fail-if-exists }}
      name: ${{ inputs.name }}
      repository: ${{ inputs.repository }}
      sha: ${{ inputs.sha }}
      summary: ${{ inputs.summary }}
      token: ${{ inputs.token || github.token }}
      version: ${{ steps.status.outputs.version }}
      version-file: ${{ inputs.version-file }}
