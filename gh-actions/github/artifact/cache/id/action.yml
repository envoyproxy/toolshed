inputs:
  name:
    type: string
    required: true
  repository:
    type: string
    required: true
    default: ${{ github.repository }}
  token:
    # requires: `actions: read`
    type: string
    required: true
    default: ${{ github.token }}

outputs:
  id:
    value: ${{ steps.cache-id.outputs.id }}


runs:
  using: composite
  steps:
  - id: cache-id
    shell: bash
    run: |
      artifact_id=$(gh api \
          -H "Accept: application/vnd.github+json" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          "/repos/${REPOSITORY}/actions/artifacts?name=${ARTIFACT_NAME}&per_page=1" \
          --jq '.artifacts[0] | .id')
      echo "id=${artifact_id}" >> $GITHUB_OUTPUT
    env:
      ARTIFACT_NAME: ${{ inputs.name }}.tar.zst
      GH_TOKEN: ${{ inputs.token }}
      REPOSITORY: ${{ inputs.repository }}
