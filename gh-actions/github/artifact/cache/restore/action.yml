inputs:
  id:
    type: string
    required: false
  name:
    type: string
    required: true
  path:
    type: string
    required: true
  repository:
    type: string
    required: true
    default: ${{ github.repository }}
  token:
    # requires: `actions: read`
    type: string
    required: true
    default: ${{ github.token }}
  wf-path:
    type: string
    required: true


runs:
  using: composite
  steps:
  - name: Find artifact cache
    if: >-
      ! inputs.id
    id: cache-id
    uses: envoyproxy/toolshed/gh-actions/github/artifact/cache/id@47eb69f4d6110d7b3f03c098affa989c65157d8f
    with:
      name: ${{ inputs.name }}
      token: ${{ inputs.token }}
      wf-path: ${{ inputs.wf-path }}
  - name: Restore artifact cache
    if: |
      inputs.id
      || steps.cache-id.outputs.id
    shell: bash
    run: |
      gh api \
          -H "Accept: application/vnd.github+json" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          "/repos/${REPOSITORY}/actions/artifacts/${ARTIFACT_ID}/zip" \
          | tar --warning=no-timestamp \
                --keep-directory-symlink \
                -xI unzstd \
                -f - \
                -C ${OUTPUT_PATH}
    env:
      GH_TOKEN: ${{ inputs.token }}
      ARTIFACT_ID: ${{ inputs.id || steps.cache-id.outputs.id }}
      OUTPUT_PATH: ${{ inputs.path }}
      REPOSITORY: ${{ inputs.repository }}
