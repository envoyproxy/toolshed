uses: ./gh-actions/test-runner
with:
  config: /tmp/testfiles/default.test.yml

before:
- shell: bash
  run: |
    mkdir -p /tmp/testfiles
- uses: envoyproxy/toolshed/gh-actions/jq@2a43b12f18b357bf5c5509dac9a3fc960a1a3ce2
  id: before
  with:
    input-format: yaml
    output-path: /tmp/testfiles/default.test.yml
    input: |
      before:
      - shell: bash
        run: |
          echo "BEFORE" >> /tmp/test-output
          mkdir /tmp/DELETEME
      uses: envoyproxy/toolshed/gh-actions/diskspace@2a43b12f18b357bf5c5509dac9a3fc960a1a3ce2
      with:
        background: false
        to_remove: |
          /tmp/DELETEME
      after:
      - shell: bash
        run: |
          echo "AFTER" >> /tmp/test-output
          ls -alh /tmp/DELETEME >& /dev/null && {
              echo "fail:/tmp/DELETEME was not deleted" >> "$TEST_OUTPUT"
          } || {
              echo "success:/tmp/DELETEME successfully removed" >> "$TEST_OUTPUT"
          }

after:
- shell: bash
  run: |
    grep BEFORE /tmp/test-output
    grep AFTER /tmp/test-output
    grep success "$TEST_OUTPUT"
