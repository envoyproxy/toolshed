uses: ./gh-actions/test-runner
with:
  config: |
    %{{ steps.before.outputs.value }}

before:
- uses: envoyproxy/toolshed/gh-actions/jq@c175595d2ff9ebd8c9a2ce94bcb34c43d0a4b2a2
  id: before
  with:
    input-format: yaml
    input: |
      before:
      - shell: bash
        run: |
          echo "BEFORE" >> /tmp/test-output
          mkdir /tmp/DELETEME
      uses: envoyproxy/toolshed/gh-actions/diskspace@c175595d2ff9ebd8c9a2ce94bcb34c43d0a4b2a2
      with:
        background: false
        to_remove: |
          /tmp/DELETEME
      after:
      - shell: bash
        run: |
          echo "AFTER" >> /tmp/test-output
          ls -alh /tmp/DELETEME >& /dev/null && {
              echo "/tmp/DELETEME was not deleted"
              exit 1
          } || {
              echo "/tmp/DELETEME successfully removed"
          }

after:
- shell: bash
  run: |
    grep BEFORE /tmp/test-output
    grep AFTER /tmp/test-output
