
runs:
  using: composite
  steps:
  - name: Install apk
    shell: bash
    run: |
      cd mobile
      "${ANDROID_HOME}/platform-tools/adb" install -r --no-incremental bazel-bin/examples/java/hello_world/hello_envoy.apk
      "${ANDROID_HOME}/platform-tools/adb" shell am start -n io.envoyproxy.envoymobile.helloenvoy/.MainActivity
  - name: 'Check connectivity'
    shell: bash
    run: |
      timeout 30 "${ANDROID_HOME}"/platform-tools/adb logcat -e "received headers with status 301" -m 1 || {
          echo "Failed checking for headers in adb logcat" >&2
          timeout 30 "${ANDROID_HOME}"/platform-tools/adb logcat || {
              echo "Failed dumping adb logcat" >&2
          }
          exit 1
      }
