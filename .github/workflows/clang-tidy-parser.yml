name: Clang-tidy parser tests

permissions:
  contents: read

on:
  pull_request:
    paths:
    - bazel/format/clang_tidy/parser/**
    - .github/workflows/clang-tidy-parser.yml
  push:
    paths:
    - bazel/format/clang_tidy/parser/**
    - .github/workflows/clang-tidy-parser.yml

jobs:
  test:
    runs-on: ubuntu-24.04

    steps:
    - name: Checkout Repository
      uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3  # v6.0.0
    
    - name: Install jq
      run: |
        sudo apt-get update
        sudo apt-get -qq install -y jq
    
    - name: Verify jq installation
      run: jq --version
    
    - name: Run parser tests
      run: ./bazel/format/clang_tidy/parser/tests/run_tests.sh
    
    - name: Test parser help/version
      run: |
        head -n 30 ./bazel/format/clang_tidy/parser/parse_clang_tidy.jq
    
    - name: Performance test
      run: |
        echo "Testing parser performance..."
        time jq -Rf ./bazel/format/clang_tidy/parser/parse_clang_tidy.jq \
          < ./bazel/format/clang_tidy/parser/tests/sample_input.txt > /dev/null
