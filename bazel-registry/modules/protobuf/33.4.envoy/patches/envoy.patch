diff --git a/BUILD.bazel b/BUILD.bazel
index 9e76da895..8d5f4f46a 100644
--- a/BUILD.bazel
+++ b/BUILD.bazel
@@ -28,6 +28,12 @@ exports_files(
     visibility = ["//cmake:__pkg__"],
 )
 
+label_flag(
+    name = "zlib",
+    build_setting_default = "@zlib",
+    visibility = ["//visibility:public"],
+)
+
 ################################################################################
 # Well Known Types Proto Library Rules
 #
@@ -354,13 +360,83 @@ alias(
 )
 
 cc_binary(
-    name = "protoc",
+    name = "compiled_protoc",
     copts = COPTS,
     linkopts = LINK_OPTS,
     visibility = ["//visibility:public"],
     deps = ["//src/google/protobuf/compiler:protoc_lib_stage1"],
 )
 
+# Lifted from `rules_proto`
+config_setting(
+    name = "linux-aarch_64",
+    constraint_values = [
+        "@platforms//os:linux",
+        "@platforms//cpu:aarch64",
+    ],
+)
+
+config_setting(
+    name = "linux-x86_64",
+    constraint_values = [
+        "@platforms//os:linux",
+        "@platforms//cpu:x86_64",
+    ],
+)
+
+config_setting(
+    name = "linux-ppcle_64",
+    constraint_values = [
+        "@platforms//os:linux",
+        "@platforms//cpu:ppc64le",
+    ],
+)
+
+config_setting(
+    name = "osx-aarch_64",
+    constraint_values = [
+        "@platforms//os:osx",
+        "@platforms//cpu:aarch64",
+    ],
+)
+
+config_setting(
+    name = "osx-x86_64",
+    constraint_values = [
+        "@platforms//os:osx",
+        "@platforms//cpu:x86_64",
+    ],
+)
+
+config_setting(
+    name = "win64",
+    constraint_values = [
+        "@platforms//os:windows",
+        "@platforms//cpu:x86_64",
+    ],
+)
+
+# Use precompiled binaries where possible.
+alias(
+    name = "protoc",
+    actual = select({
+        ":linux-aarch_64": "@prebuilt_protoc.linux_aarch_64//:protoc",
+        ":linux-x86_64": "@prebuilt_protoc.linux_x86_64//:protoc",
+        ":linux-ppcle_64": "@prebuilt_protoc.linux_ppcle_64//:protoc",
+        ":osx-aarch_64": "@prebuilt_protoc.osx_aarch_64//:protoc",
+        ":osx-x86_64": "@prebuilt_protoc.osx_x86_64//:protoc",
+        ":win64": "@prebuilt_protoc.win64//:protoc",
+        "//conditions:default": ":compiled_protoc",
+    }),
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "protobuf_python_genproto",
+    actual = "//python:well_known_types_py_pb2_genproto",
+    visibility = ["//visibility:public"],
+)
+
 cc_binary(
     name = "protoc_stage0",
     copts = COPTS,
diff --git a/bazel/private/prebuilt_protoc_toolchain.bzl b/bazel/private/prebuilt_protoc_toolchain.bzl
index b583e35d6..f1cf29f07 100644
--- a/bazel/private/prebuilt_protoc_toolchain.bzl
+++ b/bazel/private/prebuilt_protoc_toolchain.bzl
@@ -36,6 +36,11 @@ load("@com_google_protobuf//bazel/toolchains:proto_toolchain.bzl", "proto_toolch
 
 package(default_visibility = ["//visibility:public"])
 
+sh_binary(
+    name = "protoc",
+    srcs = ["{protoc_label}"],
+)
+
 proto_toolchain(
     name = "prebuilt_protoc_toolchain",
     proto_compiler = "{protoc_label}",
diff --git a/build_defs/cpp_opts.bzl b/build_defs/cpp_opts.bzl
index c0116bd76..5ce341c74 100644
--- a/build_defs/cpp_opts.bzl
+++ b/build_defs/cpp_opts.bzl
@@ -18,6 +18,7 @@ COPTS = select({
     ],
     "//conditions:default": [
         "-Wno-sign-compare",
+        "-Wno-deprecated-declarations",
     ],
 })
 
diff --git a/src/google/protobuf/BUILD.bazel b/src/google/protobuf/BUILD.bazel
index 475556bf5..ef434e99b 100644
--- a/src/google/protobuf/BUILD.bazel
+++ b/src/google/protobuf/BUILD.bazel
@@ -24,6 +24,23 @@ package(
     ],
 )
 
+exports_files(
+    [
+        "any.proto",
+        "api.proto",
+        "descriptor.proto",
+        "duration.proto",
+        "empty.proto",
+        "field_mask.proto",
+        "source_context.proto",
+        "struct.proto",
+        "timestamp.proto",
+        "type.proto",
+        "wrappers.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
+
 proto_library(
     name = "any_proto",
     srcs = ["any.proto"],
diff --git a/src/google/protobuf/compiler/BUILD.bazel b/src/google/protobuf/compiler/BUILD.bazel
index 55b22d675..df7083d44 100644
--- a/src/google/protobuf/compiler/BUILD.bazel
+++ b/src/google/protobuf/compiler/BUILD.bazel
@@ -21,6 +21,11 @@ load(
 )
 load("test_plugin_injection.bzl", "inject_plugin_paths")
 
+exports_files(
+    ["plugin.proto"],
+    visibility = ["//visibility:public"],
+)
+
 proto_library(
     name = "plugin_proto",
     srcs = ["plugin.proto"],
diff --git a/src/google/protobuf/io/BUILD.bazel b/src/google/protobuf/io/BUILD.bazel
index bb00b0acc..51d79f534 100644
--- a/src/google/protobuf/io/BUILD.bazel
+++ b/src/google/protobuf/io/BUILD.bazel
@@ -160,7 +160,7 @@ cc_library(
         "@abseil-cpp//absl/log:absl_log",
     ] + select({
         "//build_defs:config_msvc": [],
-        "//conditions:default": ["@zlib"],
+        "//conditions:default": ["//:zlib"],
     }),
 )
 
