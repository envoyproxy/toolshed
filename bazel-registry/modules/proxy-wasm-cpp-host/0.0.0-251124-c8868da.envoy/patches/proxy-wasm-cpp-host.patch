diff --git a/BUILD b/BUILD
index 6db5fd9..beafec1 100644
--- a/BUILD
+++ b/BUILD
@@ -91,7 +91,7 @@ cc_library(
         ":headers",
     ] + select({
         "//bazel:crypto_system": [],
-        "//conditions:default": ["@boringssl//:crypto"],
+        "//conditions:default": ["@envoy//bazel:boringcrypto"],
     }),
     alwayslink = 1,
 )
@@ -133,7 +133,7 @@ cc_library(
     ],
     deps = [
         ":wasm_vm_headers",
-        "//external:wee8",
+        "@v8//:wee8",
     ],
 )
 
@@ -151,7 +151,7 @@ cc_library(
     ],
     deps = [
         ":wasm_vm_headers",
-        "//external:wamr",
+        "@envoy//bazel/foreign_cc:wamr",
     ],
 )
 
@@ -217,7 +217,7 @@ cc_library(
     }),
     deps = [
         ":wasm_vm_headers",
-        "//external:wasmtime",
+        "@com_github_wasmtime//:wasmtime_lib",
     ],
 )
 
@@ -276,7 +276,7 @@ cc_library(
     }),
     deps = [
         ":wasm_vm_headers",
-        "//external:prefixed_wasmtime",
+        "@com_github_wasmtime//:prefixed_wasmtime_lib",
     ],
 )
 
diff --git a/MODULE.bazel b/MODULE.bazel
new file mode 100644
index 0000000..0f825ec
--- /dev/null
+++ b/MODULE.bazel
@@ -0,0 +1,211 @@
+# Copyright 2025 Google LLC
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#     http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+module(
+    name = "proxy_wasm_cpp_host",
+    version = "0.0.0",
+)
+
+bazel_dep(name = "envoy", version = "")
+
+bazel_dep(name = "abseil-cpp", version = "20250814.1")
+bazel_dep(name = "bazel_features", version = "1.21.0")
+bazel_dep(name = "bazel_skylib", version = "1.7.0")
+bazel_dep(name = "platforms", version = "1.0.0")
+bazel_dep(name = "protobuf", version = "33.2", repo_name = "com_google_protobuf")
+bazel_dep(name = "proxy-wasm-cpp-sdk", version = "0.0.0", repo_name = "proxy_wasm_cpp_sdk")
+bazel_dep(name = "rules_cc", version = "0.1.5")
+bazel_dep(name = "rules_license", version = "1.0.0")
+bazel_dep(name = "rules_python", version = "1.7.0")
+bazel_dep(name = "rules_rust", version = "0.68.1")
+
+git_override(
+    module_name = "proxy-wasm-cpp-sdk",
+    commit = "e5256b0c5463ea9961965ad5de3e379e00486640",
+    remote = "https://github.com/proxy-wasm/proxy-wasm-cpp-sdk",
+    patch_strip = 1,
+    patches = ["//bazel:proxy-wasm-cpp-sdk.patch"],
+)
+
+python = use_extension("@rules_python//python/extensions:python.bzl", "python")
+python.toolchain(
+    is_default = True,
+    python_version = "3.12",
+)
+use_repo(
+    python,
+    "python_3_12",
+    python = "python_versions",
+)
+pip = use_extension("@rules_python//python/extensions:pip.bzl", "pip")
+pip.parse(
+    hub_name = "v8_python_deps",
+    python_version = "3.12",
+    requirements_lock = "@v8//:bazel/requirements.txt",
+)
+use_repo(pip, "v8_python_deps")
+
+rust = use_extension("@rules_rust//rust:extensions.bzl", "rust")
+rust.toolchain(
+    edition = "2021",
+    versions = ["1.91.0"],
+)
+use_repo(rust, "rust_toolchains")
+
+register_toolchains("@rust_toolchains//:all")
+
+wasmtime = use_extension("//bazel:extensions.bzl", "wasmtime")
+use_repo(wasmtime, "com_github_wasmtime")
+
+wasmtime_crates = use_extension("//bazel:extensions.bzl", "wasmtime_crates")
+use_repo(
+    wasmtime_crates,
+    "cu",
+    "cu__ahash-0.8.11",
+    "cu__aho-corasick-1.1.3",
+    "cu__anyhow-1.0.86",
+    "cu__arbitrary-1.3.2",
+    "cu__bitflags-2.6.0",
+    "cu__bumpalo-3.16.0",
+    "cu__cc-1.1.7",
+    "cu__cfg-if-1.0.0",
+    "cu__cobs-0.2.3",
+    "cu__cranelift-bforest-0.111.0",
+    "cu__cranelift-bitset-0.111.0",
+    "cu__cranelift-codegen-0.111.0",
+    "cu__cranelift-codegen-meta-0.111.0",
+    "cu__cranelift-codegen-shared-0.111.0",
+    "cu__cranelift-control-0.111.0",
+    "cu__cranelift-entity-0.111.0",
+    "cu__cranelift-frontend-0.111.0",
+    "cu__cranelift-isle-0.111.0",
+    "cu__cranelift-native-0.111.0",
+    "cu__cranelift-wasm-0.111.0",
+    "cu__crc32fast-1.4.2",
+    "cu__either-1.13.0",
+    "cu__embedded-io-0.4.0",
+    "cu__env_logger-0.10.2",
+    "cu__equivalent-1.0.1",
+    "cu__errno-0.3.9",
+    "cu__fallible-iterator-0.3.0",
+    "cu__gimli-0.29.0",
+    "cu__hashbrown-0.13.2",
+    "cu__hashbrown-0.14.5",
+    "cu__heck-0.4.1",
+    "cu__hermit-abi-0.3.9",
+    "cu__humantime-2.1.0",
+    "cu__id-arena-2.2.1",
+    "cu__indexmap-2.3.0",
+    "cu__is-terminal-0.4.12",
+    "cu__itertools-0.12.1",
+    "cu__itoa-1.0.11",
+    "cu__leb128-0.2.5",
+    "cu__libc-0.2.155",
+    "cu__libm-0.2.8",
+    "cu__linux-raw-sys-0.4.14",
+    "cu__log-0.4.22",
+    "cu__mach2-0.4.2",
+    "cu__memchr-2.7.4",
+    "cu__memfd-0.6.4",
+    "cu__object-0.36.2",
+    "cu__once_cell-1.19.0",
+    "cu__paste-1.0.15",
+    "cu__pin-project-lite-0.2.14",
+    "cu__postcard-1.0.8",
+    "cu__proc-macro2-1.0.86",
+    "cu__psm-0.1.21",
+    "cu__quote-1.0.36",
+    "cu__regalloc2-0.9.3",
+    "cu__regex-1.10.5",
+    "cu__regex-automata-0.4.7",
+    "cu__regex-syntax-0.8.4",
+    "cu__rustc-hash-1.1.0",
+    "cu__rustix-0.38.34",
+    "cu__ryu-1.0.18",
+    "cu__semver-1.0.23",
+    "cu__serde-1.0.204",
+    "cu__serde_derive-1.0.204",
+    "cu__serde_json-1.0.120",
+    "cu__slice-group-by-0.3.1",
+    "cu__smallvec-1.13.2",
+    "cu__sptr-0.3.2",
+    "cu__stable_deref_trait-1.2.0",
+    "cu__syn-2.0.72",
+    "cu__target-lexicon-0.12.16",
+    "cu__termcolor-1.4.1",
+    "cu__thiserror-1.0.63",
+    "cu__thiserror-impl-1.0.63",
+    "cu__tracing-0.1.40",
+    "cu__tracing-attributes-0.1.27",
+    "cu__tracing-core-0.1.32",
+    "cu__unicode-ident-1.0.12",
+    "cu__unicode-xid-0.2.4",
+    "cu__version_check-0.9.5",
+    "cu__wasm-encoder-0.215.0",
+    "cu__wasmparser-0.215.0",
+    "cu__wasmprinter-0.215.0",
+    "cu__wasmtime-24.0.0",
+    "cu__wasmtime-asm-macros-24.0.0",
+    "cu__wasmtime-c-api-macros-24.0.0",
+    "cu__wasmtime-component-macro-24.0.0",
+    "cu__wasmtime-component-util-24.0.0",
+    "cu__wasmtime-cranelift-24.0.0",
+    "cu__wasmtime-environ-24.0.0",
+    "cu__wasmtime-jit-icache-coherence-24.0.0",
+    "cu__wasmtime-slab-24.0.0",
+    "cu__wasmtime-types-24.0.0",
+    "cu__wasmtime-versioned-export-macros-24.0.0",
+    "cu__wasmtime-wit-bindgen-24.0.0",
+    "cu__winapi-util-0.1.8",
+    "cu__windows-sys-0.52.0",
+    "cu__windows-targets-0.52.6",
+    "cu__windows_aarch64_gnullvm-0.52.6",
+    "cu__windows_aarch64_msvc-0.52.6",
+    "cu__windows_i686_gnu-0.52.6",
+    "cu__windows_i686_gnullvm-0.52.6",
+    "cu__windows_i686_msvc-0.52.6",
+    "cu__windows_x86_64_gnu-0.52.6",
+    "cu__windows_x86_64_gnullvm-0.52.6",
+    "cu__windows_x86_64_msvc-0.52.6",
+    "cu__wit-parser-0.215.0",
+    "cu__zerocopy-0.7.35",
+    "cu__zerocopy-derive-0.7.35",
+)
+
+# WAMR runtime
+wamr = use_extension("//bazel:extensions.bzl", "wamr")
+use_repo(wamr, "com_github_bytecodealliance_wasm_micro_runtime")
+
+# V8 runtime and its dependencies
+v8 = use_extension("//bazel:extensions.bzl", "v8")
+use_repo(v8, "v8")
+
+v8_deps = use_extension("//bazel:extensions.bzl", "v8_deps")
+use_repo(
+    v8_deps,
+    "dragonbox",
+    "fast_float",
+    "fp16",
+    "highway",
+    "intel_ittapi",
+    "simdutf",
+)
+
+# WasmEdge runtime
+wasmedge = use_extension("//bazel:extensions.bzl", "wasmedge")
+use_repo(wasmedge, "com_github_wasmedge_wasmedge")
+
+# BoringSSL (for crypto, unless using system crypto)
+boringssl = use_extension("//bazel:extensions.bzl", "boringssl")
+use_repo(boringssl, "boringssl")
diff --git a/bazel/extensions.bzl b/bazel/extensions.bzl
new file mode 100644
index 0000000..8f7af8a
--- /dev/null
+++ b/bazel/extensions.bzl
@@ -0,0 +1,178 @@
+# Copyright 2025 Google LLC
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#     http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+load("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")
+load("@bazel_tools//tools/build_defs/repo:git.bzl", "git_repository")
+load("//bazel/cargo/wasmtime/remote:crates.bzl", _wasmtime_crate_repositories = "crate_repositories")
+
+def _wasmtime_crates_impl(ctx):
+    direct_deps = _wasmtime_crate_repositories()
+    return ctx.extension_metadata(
+        root_module_direct_deps = [dep.repo for dep in direct_deps],
+        root_module_direct_dev_deps = [],
+    )
+
+wasmtime_crates = module_extension(
+    implementation = _wasmtime_crates_impl,
+)
+
+def _wasmtime_impl(ctx):
+    http_archive(
+        name = "com_github_wasmtime",
+        build_file = "@proxy_wasm_cpp_host//bazel/external:wasmtime.BUILD",
+        sha256 = "2ccb49bb3bfa4d86907ad4c80d1147aef6156c7b6e3f7f14ed02a39de9761155",
+        strip_prefix = "wasmtime-24.0.0",
+        url = "https://github.com/bytecodealliance/wasmtime/archive/v24.0.0.tar.gz",
+    )
+    return ctx.extension_metadata(
+        root_module_direct_deps = ["com_github_wasmtime"],
+        root_module_direct_dev_deps = [],
+    )
+
+wasmtime = module_extension(
+    implementation = _wasmtime_impl,
+)
+
+def _wamr_impl(ctx):
+    http_archive(
+        name = "com_github_bytecodealliance_wasm_micro_runtime",
+        build_file = "@proxy_wasm_cpp_host//bazel/external:wamr.BUILD",
+        sha256 = "ca18bbf304f47287bf43707564db63b8908dd6d0d6ac40bb39271a7144def4cc",
+        strip_prefix = "wasm-micro-runtime-WAMR-2.4.1",
+        url = "https://github.com/bytecodealliance/wasm-micro-runtime/archive/refs/tags/WAMR-2.4.1.zip",
+        patches = ["@proxy_wasm_cpp_host//bazel/external:wamr.patch"],
+        patch_args = ["-p1"],
+    )
+    return ctx.extension_metadata(
+        root_module_direct_deps = ["com_github_bytecodealliance_wasm_micro_runtime"],
+        root_module_direct_dev_deps = [],
+    )
+
+wamr = module_extension(
+    implementation = _wamr_impl,
+)
+
+def _v8_impl(ctx):
+    git_repository(
+        name = "v8",
+        commit = "de9d0f8b56ae61896e4d2ac577fc589efb14f87d",
+        remote = "https://chromium.googlesource.com/v8/v8",
+        shallow_since = "1752074621 -0700",
+        patches = ["@proxy_wasm_cpp_host//bazel/external:v8.patch"],
+        patch_args = ["-p1"],
+        patch_cmds = [
+            "find ./src ./include -type f -exec sed -i.bak -e 's!#include \"third_party/simdutf/simdutf.h\"! #include \"simdutf.h\"!' {} \\;",
+            "find ./src ./include -type f -exec sed -i.bak -e 's!#include \"third_party/fp16/src/include/fp16.h\"!#include \"fp16.h\"!' {} \\;",
+            "find ./src ./include -type f -exec sed -i.bak -e 's!#include \"third_party/dragonbox/src/include/dragonbox/dragonbox.h\"!#include \"dragonbox/dragonbox.h\"!' {} \\;",
+            "find ./src ./include -type f -exec sed -i.bak -e 's!#include \"third_party/fast_float/src/include/fast_float/! #include \"fast_float/!' {} \\;",
+        ],
+    )
+    return ctx.extension_metadata(
+        root_module_direct_deps = ["v8"],
+        root_module_direct_dev_deps = [],
+    )
+
+v8 = module_extension(
+    implementation = _v8_impl,
+)
+
+def _v8_deps_impl(ctx):
+    # V8 supporting dependencies
+    http_archive(
+        name = "highway",
+        sha256 = "7e0be78b8318e8bdbf6fa545d2ecb4c90f947df03f7aadc42c1967f019e63343",
+        urls = ["https://github.com/google/highway/archive/refs/tags/1.2.0.tar.gz"],
+        strip_prefix = "highway-1.2.0",
+    )
+    http_archive(
+        name = "fast_float",
+        sha256 = "d2a08e722f461fe699ba61392cd29e6b23be013d0f56e50c7786d0954bffcb17",
+        urls = ["https://github.com/fastfloat/fast_float/archive/refs/tags/v7.0.0.tar.gz"],
+        strip_prefix = "fast_float-7.0.0",
+    )
+    http_archive(
+        name = "dragonbox",
+        urls = ["https://github.com/jk-jeon/dragonbox/archive/6c7c925b571d54486b9ffae8d9d18a822801cbda.zip"],
+        strip_prefix = "dragonbox-6c7c925b571d54486b9ffae8d9d18a822801cbda",
+        sha256 = "2f10448d665355b41f599e869ac78803f82f13b070ce7ef5ae7b5cceb8a178f3",
+        build_file = "@proxy_wasm_cpp_host//bazel/external:dragonbox.BUILD",
+    )
+    http_archive(
+        name = "fp16",
+        urls = ["https://github.com/Maratyszcza/FP16/archive/0a92994d729ff76a58f692d3028ca1b64b145d91.zip"],
+        strip_prefix = "FP16-0a92994d729ff76a58f692d3028ca1b64b145d91",
+        sha256 = "e66e65515fa09927b348d3d584c68be4215cfe664100d01c9dbc7655a5716d70",
+        build_file = "@proxy_wasm_cpp_host//bazel/external:fp16.BUILD",
+    )
+    http_archive(
+        name = "simdutf",
+        sha256 = "512374f8291d3daf102ccd0ad223b1a8318358f7c1295efd4d9a3abbb8e4b6ff",
+        urls = ["https://github.com/simdutf/simdutf/releases/download/v7.3.0/singleheader.zip"],
+        build_file = "@proxy_wasm_cpp_host//bazel/external:simdutf.BUILD",
+    )
+    http_archive(
+        name = "intel_ittapi",
+        strip_prefix = "ittapi-a3911fff01a775023a06af8754f9ec1e5977dd97",
+        sha256 = "1d0dddfc5abb786f2340565c82c6edd1cff10c917616a18ce62ee0b94dbc2ed4",
+        urls = ["https://github.com/intel/ittapi/archive/a3911fff01a775023a06af8754f9ec1e5977dd97.tar.gz"],
+        build_file = "@proxy_wasm_cpp_host//bazel/external: intel_ittapi.BUILD",
+    )
+    return ctx.extension_metadata(
+        root_module_direct_deps = [
+            "highway",
+            "fast_float",
+            "dragonbox",
+            "fp16",
+            "simdutf",
+            "intel_ittapi",
+        ],
+        root_module_direct_dev_deps = [],
+    )
+
+v8_deps = module_extension(
+    implementation = _v8_deps_impl,
+)
+
+def _wasmedge_impl(ctx):
+    http_archive(
+        name = "com_github_wasmedge_wasmedge",
+        build_file = "@proxy_wasm_cpp_host//bazel/external:wasmedge.BUILD",
+        sha256 = "7ab8a0df37c8d282ecff72d0f0bff8db63fd92df1645d5a014a9dbed4b7f9025",
+        strip_prefix = "WasmEdge-proxy-wasm-0.13.1",
+        url = "https://github.com/WasmEdge/WasmEdge/archive/refs/tags/proxy-wasm/0.13.1.tar.gz",
+    )
+    return ctx.extension_metadata(
+        root_module_direct_deps = ["com_github_wasmedge_wasmedge"],
+        root_module_direct_dev_deps = [],
+    )
+
+wasmedge = module_extension(
+    implementation = _wasmedge_impl,
+)
+
+def _boringssl_impl(ctx):
+    http_archive(
+        name = "boringssl",
+        sha256 = "f1f421738e9ba39dd88daf8cf3096ddba9c53e2b6b41b32fff5a3ff82f4cd162",
+        strip_prefix = "boringssl-45cf810dbdbd767f09f8cb0b0fcccd342c39041f",
+        urls = ["https://github.com/google/boringssl/archive/45cf810dbdbd767f09f8cb0b0fcccd342c39041f.tar.gz"],
+    )
+    return ctx.extension_metadata(
+        root_module_direct_deps = ["boringssl"],
+        root_module_direct_dev_deps = [],
+    )
+
+boringssl = module_extension(
+    implementation = _boringssl_impl,
+)
diff --git a/include/proxy-wasm/wasm_vm.h b/include/proxy-wasm/wasm_vm.h
index 9a2f0a6..e2e2ea0 100644
--- a/include/proxy-wasm/wasm_vm.h
+++ b/include/proxy-wasm/wasm_vm.h
@@ -161,7 +161,7 @@ struct WasmVmIntegration {
   virtual proxy_wasm::LogLevel getLogLevel() = 0;
   virtual void error(std::string_view message) = 0;
   // Allow integrations to handle specific FailStates differently.
-  virtual void error(FailState fail_state, std::string_view message) { error(message); }
+  virtual void error(FailState, std::string_view message) { error(message); }
   virtual void trace(std::string_view message) = 0;
   // Get a NullVm implementation of a function.
   // @param function_name is the name of the function with the implementation specific prefix.
